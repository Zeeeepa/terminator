---
# Install Google Chrome using the general-purpose installer
# Demonstrates using the generic workflow with Chrome-specific parameters
tool_name: execute_sequence
arguments:
  steps:
    - tool_name: execute_sequence
      arguments:
        workflow_file: "./install-software.yml"
        inputs:
          software_name: "Google Chrome"
          package_id: "Google.Chrome"
          download_url: "https://dl.google.com/chrome/install/latest/chrome_installer.exe"
          silent_install_args: "/silent /install"
          ui_install_steps:
            - tool_name: click_element
              arguments:
                selector: "role:Button|name:Accept and Install"
            - tool_name: wait_for_element
              arguments:
                selector: "role:Window|name:Google Chrome"
                timeout_ms: 60000
      id: "install_chrome"

    # Optionally set Chrome as default browser
    - tool_name: run_command
      arguments:
        run: |
          # Set Chrome as default browser on Windows
          $chromePath = "${env:ProgramFiles}\Google\Chrome\Application\chrome.exe"
          if (Test-Path $chromePath) {
            # Register Chrome as default
            Start-Process $chromePath -ArgumentList "--make-default-browser" -Wait
            Write-Host "Chrome set as default browser"
          }
        shell: powershell
      id: "set_default"
      continue_on_error: true
      delay_ms: 2000

  output_parser:
    javascript_code: |
      const installStep = context.steps.find(s => s.id === 'install_chrome');
      const success = installStep?.status === 'success';

      return {
        success: success,
        data: {
          software: 'Google Chrome',
          installed: success,
          default_browser: context.steps.find(s => s.id === 'set_default')?.status === 'success'
        }
      };